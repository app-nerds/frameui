const debounce=(fn,delay=400)=>{let e=null;return function(){let t=arguments;clearTimeout(e),e=setTimeout(()=>{fn.apply(this,t)},delay)}};class TagCloud extends HTMLElement{constructor(){super(),this._tags=[],this._container=document.createElement("div"),this._container.classList.add("tag-cloud-container")}connectedCallback(){this._render(),this.appendChild(this._container)}addTags(tags){tags.forEach(tag=>{this._tags.find(t=>t.id===tag.id)||this._tags.push(tag)}),this._render()}_render(){this._container.innerHTML="",this._tags.forEach(tag=>{this._container.appendChild(this._renderTag(tag))})}_renderTag(tag){const t=document.createElement("div"),i=(t.classList.add("tag-cloud-tag"),t.textContent=tag.label,t.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("tag-click",{detail:tag}))}),document.createElement("i"));return i.classList.add("tag-cloud-icon"),i.classList.add("tag-cloud-icon-close"),i.addEventListener("click",e=>{e.stopPropagation(),this._removeTag(tag)}),t.appendChild(i),t}_removeTag(tag){this._tags=this._tags.filter(t=>t.id!==tag.id),this._render(),this.dispatchEvent(new CustomEvent("tag-remove",{detail:tag}))}}customElements.get("tag-cloud")||customElements.define("tag-cloud",TagCloud);class AutoComplete extends HTMLElement{constructor(){super(),this._options=[],this._isVisible=!1,this._placeholder=this.getAttribute("placeholder")||"",this._label=this.getAttribute("label"),this._name=this.getAttribute("name")||"autocomplete",this._multiple="true"===this.getAttribute("multiple"),this._submissionStyle=this.getAttribute("submission-style")||"delimited",this._delimiter=this.getAttribute("delimiter")||",",this._debounce=this.getAttribute("debounce")?parseInt(this.getAttribute("debounce")):300,this._textFieldID="autoCompleteTextField"+Math.floor(1e5*Math.random()),this._textField=null,this._hiddenFields=[],this._optionsContainer=null,this._tagCloud=null,this._foundOptions=[],this._highlightOption=-1,this._createComponents()}connectedCallback(){this._textField.addEventListener("input",this._onTextFieldInput.bind(this)),this._textField.addEventListener("click",()=>{this._textField.value&&this._onTextFieldInput({target:{value:this._textField.value}})}),document.addEventListener("click",e=>{e.target===this._textField||this.contains(e.target)||this._hide()})}get onChange(){return this._onChange}set onChange(fn){this._onChange=fn}get options(){return this._options}set options(value){this._options=value}_appendValue(data){if(console.log("appending new selection: ",data),this._tagCloud.addTags([{id:data.value,label:data.label,data:data.data}]),"multiple"===this._submissionStyle){const t=document.createElement("hidden");return t.type="hidden",t.name=""+this._name+(this._hiddenFields.length+1),t.value=data.value,this._hiddenFields.push(t),void this.appendChild(t)}if("delimited"===this._submissionStyle){const e=this._hiddenFields[0].value,i=e.split(this._delimiter);return i.push(""+data.value),void(this._hiddenFields[0].value=this._removeBlankEntries(i).join(this._delimiter))}this._submissionStyle}_createComponents(){if(this._label){const t=document.createElement("label");t.setAttribute("for",this._textFieldID),t.textContent=this._label,this.appendChild(t)}if(this._textField=document.createElement("input"),this._textField.type="text",this._textField.id=this._textFieldID,this._textField.placeholder=this._placeholder,this._textField.autocomplete="off",this._textField.addEventListener("keydown",this._onNavigation.bind(this)),this._textField.style.marginBottom="0.24rem",this.appendChild(this._textField),!this._multiple||this._multiple&&"multiple"!==this._submissionStyle){const e=document.createElement("input");e.type="hidden",e.name=this._name,this._hiddenFields.push(e),this.appendChild(e)}this._multiple&&(this._tagCloud=new TagCloud,this._tagCloud.addEventListener("tag-remove",this._onRemoveSelection.bind(this)),this.appendChild(this._tagCloud)),this._optionsContainer=document.createElement("ul"),this._optionsContainer.classList.add("autocomplete-options-container"),this._optionsContainer.classList.add("autocomplete-options-hidden"),this.appendChild(this._optionsContainer)}_hide(){this._isVisible=!1,this._optionsContainer.classList.add("autocomplete-options-hidden")}_highlightNextOption(){0===this._foundOptions.length?this._highlightOption=-1:(this._highlightOption++,this._highlightOption>=this._foundOptions.length&&(this._highlightOption=0))}_highlightPreviousOption(){0===this._foundOptions.length?this._highlightOption=-1:(this._highlightOption--,this._highlightOption<0&&(this._highlightOption=this._foundOptions.length-1))}_onNavigation(e){if(console.group("_onNavigation"),console.log("in keydown: ",e),this._isVisible)return"ArrowDown"===e.key?(console.log("arrow down"),e.preventDefault(),this._highlightNextOption(),this._renderOptions(),void console.groupEnd()):"ArrowUp"===e.key?(e.preventDefault(),this._highlightPreviousOption(),void this._renderOptions()):void("Enter"===e.key&&(e.preventDefault(),this._selectHighlightedOption()));console.log("returning because we aren't visible"),console.groupEnd()}_onRemoveSelection(e){console.log("removing "+e.detail.label)}_onSelectOption(data){this._multiple?this._appendValue(data):this._setValue(data),this._hide()}async _onTextFieldInput(e){""===e.target.value?this._hide():(this._foundOptions=await this._searchOptions(e.target.value),0===this._foundOptions.length?this._isVisible&&this._hide():(this._renderOptions(),this._trigger()))}_removeBlankEntries(values){return values.filter(v=>!!v&&""!==v)}_renderOptions(){this._optionsContainer.innerHTML="",this._foundOptions.forEach((option,index)=>{const t=document.createElement("li"),i=(t.classList.add("autocomplete-option"),t.addEventListener("click",e=>{e.stopPropagation(),this._onSelectOption(option)}),document.createElement("a"));i.textContent=option.label,i.href="javascript:void(0)",i.dataset.id=option.value,option.data&&(i.dataset.data=JSON.stringify(option.data)),this._highlightOption===index&&i.classList.add("hover"),i.addEventListener("click",e=>{e.stopPropagation(),this._onSelectOption(option)}),t.appendChild(i),t.addEventListener("mouseover",()=>{this._optionsContainer.querySelectorAll("a").forEach(anchor=>{anchor.classList.remove("hover")})}),this._optionsContainer.appendChild(t)})}async _searchOptions(searchTerm){return new Promise(resolve=>{var t;"function"==typeof this._options?debounce(async()=>{var t=await this._options(searchTerm);resolve(t)},this._debounce):(t=this._options.filter(option=>option.label.toLowerCase().includes(searchTerm.toLowerCase())),resolve(t))})}_setValue(data){this._textField.value=data.label,this._hiddenFields[0].value=data.value,this.dispatchEvent(new CustomEvent("select",{detail:data}))}_trigger(){var t=document.getElementById(this._textFieldID).getBoundingClientRect(),e=this._optionsContainer.getBoundingClientRect(),i=t.left,i=(this._optionsContainer.style.left=i+"px",i+e.width>window.innerWidth&&(i=window.innerWidth-e.width-3,this._optionsContainer.style.left=i+"px"),t.y+t.height+3);this._optionsContainer.style.top=i+"px",i+e.height>window.innerHeight&&(i=t.y-e.height-3,this._optionsContainer.style.top=i+"px"),this._isVisible=!0,this._optionsContainer.classList.remove("autocomplete-options-hidden")}}customElements.get("auto-complete")||customElements.define("auto-complete",AutoComplete);export{AutoComplete};