async function fetcher(url,options,spinner,msBeforeShowSpinner=1e3){let t,e;spinner&&(t=setTimeout(()=>{spinner.show()},msBeforeShowSpinner));try{e=await fetch(url,options)}finally{spinner&&(clearTimeout(t),spinner.hide())}return e}class AjaxTable extends HTMLElement{constructor(){super(),this._data=[],this._totalCount=0,this._page=0,this._tbody=null,this._previousButtonEl=null,this._pageInfoEl=null,this._nextButtonEl=null,this._fetchOnLoad="false"!==this.getAttribute("fetch-on-load"),this._url=this.getAttribute("url"),this._recordsKey=this.getAttribute("records-key"),this._totalCountKey=this.getAttribute("total-count-key"),this._pageKey=this.getAttribute("page-key"),this._previousButton=this.getAttribute("previous-button"),this._pageInfo=this.getAttribute("page-info"),this._nextButton=this.getAttribute("next-button"),this._fetcher=null,this._columnMapping=[],this._noPagesText="No pages"}get fetcher(){return this._fetcher}set fetcher(value){if("function"!=typeof value)throw new Error("'fetcher' must be a function");this._fetcher=value,this._fetchOnLoad&&this._fetch()}get columnMapping(){return this._columnMapping}set columnMapping(value){this._columnMapping=value}get data(){return this._data}set data(value){this._data=value,this._fetch()}reload(){this._fetch()}setColumnMapping(index,mapping){this._columnMapping[index]=mapping}connectedCallback(){if(!this.querySelector("table"))throw new Error("You must provide a table element inside of this control");if(this._tbody=this.querySelector("table").querySelector("tbody"),!this._tbody)throw new Error("You must provide a tbody element inside of the table");if(this._usePagingInfo()){if(this._previousButtonEl=this.querySelector(this._previousButton),this._nextButtonEl=this.querySelector(this._nextButton),this._pageInfoEl=this.querySelector(this._pageInfo),!this._previousButtonEl||!this._nextButtonEl||!this._pageInfoEl)throw new Error("You must provide previousButton, nextButton, and pageInfo elements when paging keys are provided");this._noPagesText=this._pageInfo.innerHTML,this._previousButtonEl.addEventListener("click",this._goToPreviousPage.bind(this)),this._nextButtonEl.addEventListener("click",this._goToNextPage.bind(this))}const t=this.querySelectorAll("table thead th");t.forEach(el=>{el=el.dataset.key;el?this._columnMapping.push(el):this._columnMapping.push(null)}),this._url&&this._fetchOnLoad&&this._fetch()}async _fetch(){if(!this._columnMapping||!this._columnMapping.length)throw new Error("You must provide a columnMapping");this.dispatchEvent(new CustomEvent("before-fetch",{})),await this._getDataAndPagingInfo(),this._renderTable(),this.dispatchEvent(new CustomEvent("after-fetch",{detail:this._data}))}async _getDataAndPagingInfo(){let t={};this._url?t=await this._getDataFromURL():this._fetcher&&(t=await this._fetcher(this._page||1)),this._recordsKey in t&&(this._data=t[this._recordsKey]),this._usePagingInfo()&&this._responseHasPagingInfo(t)&&(this._data=t[this._recordsKey],this._page=t[this._pageKey]),this._totalCountKey in t&&(this._totalCount=t[this._totalCountKey])}async _getDataFromURL(){var t=this._page||1;const e=await fetcher(this._url+"?page="+t,{method:"GET",headers:{"Content-Type":"application/json"}});return await e.json()}_renderTable(){this._tbody.innerHTML="",this._data.forEach(record=>{const t=document.createElement("tr");this._columnMapping.forEach((columnMapping,index)=>{columnMapping=this._renderColumnData(columnMapping,record,index),index=this._createColumn(columnMapping);t.appendChild(index)}),this._tbody.appendChild(t)}),this._previousButtonEl.disabled=!this._hasPreviousPage(),this._nextButtonEl.disabled=!this._hasNextPage(),this._data.length<=0?this._pageInfoEl.innerHTML=this._noPagesText:this._pageInfoEl.innerHTML=`Page ${this._page} of `+this._calculateNumPages()}_createColumn(content){const t=document.createElement("td");return"string"==typeof content?t.innerHTML=content:"object"==typeof content&&t.appendChild(content),t}_renderColumnData(columnMapping,record,index){return"string"==typeof columnMapping?record[columnMapping]:"function"==typeof columnMapping?columnMapping(record,index):""}_usePagingInfo(){return this._pageKey&&this._totalCountKey}_responseHasPagingInfo(response){return this._pageKey in response&&this._totalCountKey in response}_calculateNumPages(){var t=this._data.length;return Math.round(this._totalCount/t)}_hasNextPage(){var t=this._data.length;return(this._page-1)*t+t<this._totalCount}_hasPreviousPage(){return 1<this._page}_goToNextPage(){this._hasNextPage()&&(this._page++,this.dispatchEvent(new CustomEvent("page-change",{detail:this._page})),this._fetch())}_goToPreviousPage(){this._hasPreviousPage()&&(this._page--,this.dispatchEvent(new CustomEvent("page-change",{detail:this._page})),this._fetch())}}customElements.get("ajax-table")||customElements.define("ajax-table",AjaxTable);export{AjaxTable};