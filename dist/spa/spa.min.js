const objectToMap=(o={})=>{let e=new Map;for(const t in o)e.set(t,o[t]);return e};class BaseView extends HTMLElement{constructor(params,_onRenderComplete){super(),this._title="",this.params=params,this._state={},this._onRenderComplete=window._router.onRenderComplete||null,this.router=window._router}async connectedCallback(){await this.beforeRender(),await this.render(),this._setDocumentTitle(),await this.afterRender(),this._onRenderComplete&&this._onRenderComplete(this)}disconnectedCallback(){this.onUnload()}async beforeRender(){}async afterRender(){}async onUnload(){}async render(){throw new Error("not implemented")}get title(){return this._title}get html(){return this._html}get state(){return this._state}set state(newState){this._state=newState}getQueryParam(paramName){return this.router.getQueryParam(paramName)}navigateTo(url,queryParams={},state={}){this.router.navigateTo(url,queryParams,state)}_setDocumentTitle(){var e=this.querySelectorAll("title");e&&0<e.length&&(this._title=e[0].innerText,document.title=this._title,this.removeChild(e[0]))}}class DefaultPageNotFound extends BaseView{constructor(params){super(params)}async render(){return`
			<title>Page Not Found</title>
			<p>The page ${this.params.path} could not be found.</p>
		`}}customElements.get("default-page-not-found")||customElements.define("default-page-not-found",DefaultPageNotFound);class Router{constructor(targetEl,routes,pageNotFoundView=null){this.targetEl=targetEl,this.routes=routes,this.pageNotFoundView=pageNotFoundView,this.beforeRoute=null,this.afterRoute=null,this.injectParams=null,this.onRenderComplete=null,this.pageNotFoundView?this.routes.push({path:"/404notfound/:path",view:this.pageNotFoundView}):this.routes.push({path:"/404notfound/:path",view:DefaultPageNotFound})}getQueryParam(paramName){let e=new URLSearchParams(location.search);return e.get(paramName)}navigateTo(url,queryParams={},state={}){let t="";if(0<Object.keys(queryParams).length){var r,o,queryParams=objectToMap(queryParams);t+="?";for([r,o]of queryParams){var a=encodeURIComponent(r);let e=o;"object"==typeof o&&(e=JSON.stringify(o));var n=encodeURIComponent(e);t+=a+`=${n}&`}}history.pushState(state,null,""+url+t),this._route({state:state})}_pathToRegex(path){return new RegExp("^"+path.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")+"$")}_getParams(match){let e=0;var t=match.result.slice(1),r=Array.from(match.route.path.matchAll(/:(\w+)/g)).map(result=>result[1]);let o={};for(e=0;e<t.length;e++)o[r[e]]=t[e];if(this.injectParams){var a=this.injectParams(match);for(const n in a)o[n]=a[n]}return o}async _route(e){let t={};e.state&&(t=e.state);const r=this.routes.map(route=>({route:route,result:location.pathname.match(this._pathToRegex(route.path))}));let o=r.find(potentialMatch=>null!==potentialMatch.result);if(o){if(!this.beforeRoute||!1!==this.beforeRoute.apply(this,o.route)){e=this._getParams(o);const a=new o.route.view(e),n=(a.state=t,document.querySelector(this.targetEl));n.innerHTML="",n.appendChild(a),this.afterRoute&&this.afterRoute(o.route)}}else this.navigateTo("/404notfound"+location.pathname)}}const application=(targetElement,routes,pageNotFoundView=DefaultPageNotFound)=>(window._router=new Router(targetElement,routes,pageNotFoundView),window.navigateTo=window._router.navigateTo.bind(window._router),window.addEventListener("popstate",e=>{window._router._route({state:e.state})}),{routes:routes,targetElement:targetElement,router:window._router,afterRoute:f=>{window._router.afterRoute=f.bind(window._router)},beforeRoute:f=>{window._router.beforeRoute=f.bind(window._router)},injectParams:f=>{window._router.injectParams=f.bind(window._router)},onRenderComplete:f=>{window._router.onRenderComplete=f.bind(window._router)},go:()=>{window._router._route({})}});export{application};